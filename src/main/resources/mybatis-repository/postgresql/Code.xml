<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.back.api.repository.CodeRepository">

    <select id="findAll" parameterType="user" resultType="user">
        SELECT  ID,
                NAME,
                EMAIL,
                BIRTH,
                PASSWORD,
                PHONE,
                CREATED_AT,
                UPDATED_AT
        FROM TB_USER
        WHERE 1=1
        <if test='name != "" and name != null'>
            AND NAME = #{name}
        </if>
        <if test='email != "" and email != null'>
            AND EMAIL = #{email}
        </if>
    </select>


    <select id="findById" parameterType="int" resultType="user">
        SELECT ID,
               NAME,
               EMAIL,
               BIRTH,
               PASSWORD,
               PHONE,
               CREATED_AT,
               UPDATED_AT
        FROM TB_USER
        WHERE ID = #{id}
    </select>


    <insert id="save" parameterType="user">
        <selectKey keyProperty="id" resultType="int" order="BEFORE">
            select COALESCE(MAX(id), 0) + 1  AS id FROM TB_USER
        </selectKey>
        INSERT INTO TB_USER
        (
        ID
        , NAME
        , EMAIL
        , BIRTH
        , PASSWORD
        , PHONE
        , CREATED_AT
        )
        VALUES
        (
        #{id}
        , #{name}
        , #{email}
        , #{birth}
        , #{password}
        , #{phone}
        , now()
        )
    </insert>


    <update id="update" parameterType="user">
        UPDATE TB_USER
        SET UPDATED_AT = now()
        <if test='name != "" and name != null'>
            , NAME = #{name}
        </if>
        <if test='password != "" and password != null'>
            , PASSWORD = #{password}
        </if>
        <if test='phone != "" and phone != null'>
            , PHONE = #{phone}
        </if>
        WHERE ID = #{id}
    </update>


    <delete id="deleteById" parameterType="int">
        DELETE TB_USER
		WHERE ID = #{id}
    </delete>

</mapper>